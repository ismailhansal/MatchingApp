UPDATED FIRESTORE RULES - Copy and paste this into Firebase Console

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - public read, write only own
    match /users/{userId} {
      allow read: if true;  // Public read - needed for discover feature
      allow write: if request.auth.uid == userId;  // Only own edits
    }
    
    // Mentors collection - public read, write only own
    match /mentors/{userId} {
      allow read: if true;
      allow write: if request.auth.uid == userId;
    }
    
    // Mentees collection - public read, write only own
    match /mentees/{userId} {
      allow read: if true;
      allow write: if request.auth.uid == userId;
    }

    // Swipes collection - Allow users to create their own swipes, read swipes involving them
    match /swipes/{swipeId} {
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      allow read: if request.auth != null; // Allow any auth user to check for swipes (needed for match detection)
      allow delete: if request.auth.uid == resource.data.userId;
    }

    // Matches collection - both users must be mentor or mentee in the pair
    match /matches/{matchId} {
      allow create: if request.auth != null && (
        request.auth.uid == request.resource.data.mentorId || 
        request.auth.uid == request.resource.data.menteeId
      );
      allow read: if request.auth != null; // Allow any auth user to query matches
      allow update, delete: if request.auth.uid == resource.data.mentorId || request.auth.uid == resource.data.menteeId;
    }

    // Conversations collection - only participants can access
    match /conversations/{conversationId} {
      allow read: if request.auth != null; // Allow any auth user to read (check if conversation exists)
      allow create: if request.auth != null && request.auth.uid in request.resource.data.participants;
      allow update: if request.auth != null && request.auth.uid in resource.data.participants;
      allow delete: if request.auth != null && request.auth.uid in resource.data.participants;
      
      // Messages subcollection
      match /messages/{messageId} {
        allow read: if request.auth != null && 
                       request.auth.uid in get(/databases/$(database)/documents/conversations/$(conversationId)).data.participants;
        allow create: if request.auth != null && 
                         request.auth.uid == request.resource.data.sender;
        allow update, delete: if request.auth != null && request.auth.uid == resource.data.sender;
      }
    }
  }
}

KEY CHANGES:
1. Swipes: Added request.auth != null check and allow delete
2. Matches: Added request.auth != null check and allow update/delete
3. Conversations: Added request.auth != null checks
4. Messages: Added request.auth != null checks

STEPS TO APPLY:
1. Go to Firebase Console -> Select your project
2. Go to Firestore Database -> Rules tab
3. Replace all existing rules with the above
4. Click "Publish"
5. Test the app again
